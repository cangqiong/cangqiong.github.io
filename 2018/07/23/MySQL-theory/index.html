<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>MySQL原理 | </title>
    <meta name="author" content="Chason">
    
    <meta name="description" content="记录自己的生活与学习">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="MySQL原理"/>
    <meta property="og:site_name" content="Chason&#39;s Blog.渺沧海之一粟"/>

    
    <meta property="og:image" content=""/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="Chason&#39;s Blog.渺沧海之一粟" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">Chason&#39;s Blog.渺沧海之一粟</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="https://avatars0.githubusercontent.com/u/4538700?s=400&amp;u=393d7e2db39838e9b7404e8f5304d20eda75382b&amp;v=4" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">Chason</p>
                        <p class="desc">后台开发/JAVA/技术宅</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/2018/">
                    2018 <span class="right">14 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/2018/技术总结/">
                    技术总结 <span class="right">11 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/2018/设计/">
                    设计 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/2018/学习/">
                    学习 <span class="right">2 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-2" collapse-level="2">
                <a class="no-padding" href="/categories/2018/学习/总结/">
                    总结 <span class="right">2 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/2018/">2018</a><a class="breadcrumb" href="/categories/2018/技术总结/">技术总结</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>MySQL原理</h1>
    


       <div style="float: right;color: #E91E63">
    <span id="busuanzi_container_page_pv" style="display: none;">
    阅读次数 <span id="busuanzi_value_page_pv"></span></span>
</div>
            </div>
            <time class="pink-link-context" datetime="2018-07-23T04:06:25.000Z"><a href="/2018/07/23/MySQL-theory/">2018-07-23</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/DB/" class="chip pink lighten-1">DB</a>
        
            <a href="/tags/MySQL/" class="chip pink lighten-1">MySQL</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#MySQL数据库介绍"><span class="section table-of-contents-text">MySQL数据库介绍</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#数据库与索引"><span class="section table-of-contents-text">数据库与索引</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#从BST到B-Tree"><span class="section table-of-contents-text">从BST到B+Tree</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#索引"><span class="section table-of-contents-text">索引</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#二叉搜索树"><span class="section table-of-contents-text">二叉搜索树</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#B树"><span class="section table-of-contents-text">B树</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#B-树"><span class="section table-of-contents-text">B+树</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#MySQL的核心架构"><span class="section table-of-contents-text">MySQL的核心架构</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#MySQL存储引擎"><span class="section table-of-contents-text">MySQL存储引擎</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#聚簇索引与非聚簇索引"><span class="section table-of-contents-text">聚簇索引与非聚簇索引</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#MyISAM存储引擎"><span class="section table-of-contents-text">MyISAM存储引擎</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#InnoDB存储引擎"><span class="section table-of-contents-text">InnoDB存储引擎</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#聚集索引与非聚集索引"><span class="section table-of-contents-text">聚集索引与非聚集索引</span></a></li></ol></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#InnoDB实际存储结构"><span class="section table-of-contents-text">InnoDB实际存储结构</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#优化建议"><span class="section table-of-contents-text">优化建议</span></a></li></ol>
</div>


            <div class="entry pink-link-context">
                <h1 id="MySQL数据库介绍"><a href="#MySQL数据库介绍" class="headerlink" title="MySQL数据库介绍"></a>MySQL数据库介绍</h1><p>MySQL作为世界最流行的数据库，国内公司在经历去IOE之后，相信使用MySQL的公司相会更多。MySQL是一种一种小型关系型数据库，有体积小、速度快、可移植高、免费开源等优点。了解MySQL的其对应的核心原理到底是什么，对具体使用MySQL与优化有很大的帮助。因此本文介绍一下MySQL的底层原理，当然这只是MySQL的一小部分。</p>
<h1 id="数据库与索引"><a href="#数据库与索引" class="headerlink" title="数据库与索引"></a>数据库与索引</h1><blockquote>
<p>数据库其本质是采用<strong>一定方式</strong>存储能给多个用户共享、尽量少的冗余，与应用程序彼此独立的数据集合。</p>
</blockquote>
<p>一般而言，一定方式是指数据的组织方式，通常既包含逻辑结构，又包含存储对应的物理结构。逻辑结构包括关系型数据库（Relational database）与NoSQL，而传统数据库对应的存储的物理结构一般是采用B+Tree的形式进行存储。后面会介绍为什么采用B+Tree的存储数据。</p>
<p>传统的关系型数据库为了保证数据的持久性与可靠性，是将数据存储在磁盘中的。但基于磁盘存储有两大特性：</p>
<ol>
<li><p>磁盘IO性能非常底，严重影响数据库系统的性能。</p>
</li>
<li><p>磁盘顺序读写比随机读写的性能高很多。</p>
</li>
</ol>
<p>MySQL正是基于上面的两点特性与索引特性，对数据的组织方式进行不断优化，从而达到存取速度提升，提升性能的目标。</p>
<h1 id="从BST到B-Tree"><a href="#从BST到B-Tree" class="headerlink" title="从BST到B+Tree"></a>从BST到B+Tree</h1><p>那为什么传统数据库采用B+Tree的形式存储数据呢？</p>
<p>为了读取数据库中的数据，对数据进行全表搜索的话，必须对存储的数据结构进行优化，否则采用最原始的顺序存储的话，搜索的算法复杂度为O(n)，而且每读一条数据，就得进行磁盘IO一次，进行n次IO，相信这速度查询一次已经慢得可以先吃顿饭了。这显然太慢了，那怎么优化查找速度呢。</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>在多数情况下，我们发现并不需要匹配整行数据，而是只需要匹配某一个或几个列的值，这些用来确定或标识一条数据的列可以成为索引(<code>Index</code>)。<strong>索引实际上是一种存储数据中的特定列值的数据结构</strong>。<strong>索引本质是一种数据结构。</strong></p>
<p>索引可以类比书中的目录，目录是书中特定章节(列)的文字（值），目录指向页数，而索引指向数据存储的地址。读者可以通过目录快速找到自己想要的内容，我们可以通过索引快速定位到查找的数据。 当然如果要查找的数据不在索引中，那就相当于翻阅整本书来查找数据，也就是顺序扫描。</p>
<p>索引可以分为主键索引（Primary key）与辅助索引(Secondary key)，主键索引要求key是唯一的，而辅助索引的key可以重复，辅助索引可以有多个。</p>
<h2 id="二叉搜索树"><a href="#二叉搜索树" class="headerlink" title="二叉搜索树"></a>二叉搜索树</h2><p>给数据建立索引后，那如何组织这些索引与数据呢？既然是为了查找数据，当然有人想到二叉搜索树（BST）</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2014/bg2014070402.png" alt="二叉搜索树"></p>
<p>二叉搜索树是一种搜索效率很高的数据结构，二叉搜索树在n个节点中找到目标之，一般只需要log(n)次比较：</p>
<blockquote>
<ol>
<li>每个节点最多有两个子树。</li>
<li>若它的左子树不空，则左子树上所有结点的值均小于它的根结点的值； 若它的右子树不空，则右子树上所有结点的值均大于它的根结点的值；</li>
<li>它的左、右子树也分别为二叉排序树。</li>
</ol>
</blockquote>
<p>二叉搜索树在n个节点中找到目标之，一般只需要log(n)次比较，但二叉搜索树的结构不适合数据库，因为它的查找层次太高，极端情况下n个数据需要比较n次才能得到数据。如果有1万条数据的话，平均需要查找log(10000)=13次，这意味着要进行磁盘IO 13次，因为磁盘IO的速度远远大于数据处理的时间，查找效率还是太低。</p>
<h2 id="B树"><a href="#B树" class="headerlink" title="B树"></a>B树</h2><p>B树是对二叉搜索树的改进，可以认为它是m叉的多路平衡查找树。它将相关数据尽量集中在一起，以便读取多个数据，减少硬盘操作次数。</p>
<p>B树的特性：</p>
<ol>
<li><p>任意非叶节点都最多只有M个儿子，且M&gt;2.</p>
</li>
<li><p>所有叶子结点都出现在同一层 。</p>
</li>
<li>子节点中的值，与父节点的值，有严格的大小对应关系。子节点的数量会比父节点的键值的数量大1，如下图所示，父节点有有2个键值，而子节点有3个节点，第一个子节点中值都小于7，第二个节点的值在7与16之间，第三个节点中的值大于16。</li>
</ol>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/B-tree.svg/400px-B-tree.svg.png" alt="img"> </p>
<p>一个Ｂ树通过约束所有叶子节点在相同深度来保持平衡。深度在元素添加至树的过程中缓慢增长，而整体深度极少地增长，B树就形成非常扁平的树了。这样采用B树存储的数据，读取磁盘的次数相对于二叉搜索树就大大减少了，从而提升了查询效率。</p>
<h2 id="B-树"><a href="#B-树" class="headerlink" title="B+树"></a>B+树</h2><p>B树大大降低了搜索的层次，减少了磁盘IO次数，但当进行范围扫描时，还是需要不断进行中序遍历，于是产生了B树的变种：B+Tree。</p>
<p>B+Tree的特性：</p>
<ol>
<li><p>有n棵子树的非叶子结点中含有n个关键字（b树是n-1个），这些关键字不保存数据，只用来索引，所有数据都保存在叶子节点（b树是每个关键字都保存数据）。</p>
</li>
<li><p>所有的叶子结点中包含了全部关键字的信息，及指向含这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。</p>
</li>
<li><p>所有的非叶子结点可以看成是索引部分，结点中仅含其子树中的最大（或最小）关键字。</p>
</li>
<li><p>通常在b+树上有两个头指针，一个指向根结点，一个指向关键字最小的叶子结点。</p>
<p><img src="http://img.mp.sohu.com/upload/20170713/358025867be14bb99bf8806b98e774d9_th.png" alt="B+树"> </p>
</li>
</ol>
<p>B+树的中间节点不保存数据，磁盘能容纳更多的节点，相比B树更扁平。对于范围查找，B+树只用遍历叶子节点链表。</p>
<h1 id="MySQL的核心架构"><a href="#MySQL的核心架构" class="headerlink" title="MySQL的核心架构"></a>MySQL的核心架构</h1><p>让我们现在了解一下MySQL的核心架构：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/838913-fb7f263a0d00afe7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/583" alt="MySQL架构"> </p>
<p>MySQL的核心架构如上图所示，</p>
<ul>
<li>第一层：服务层为客户端的请求进行处理，包括连接管理、授权认证、安全等。 </li>
<li>第二层：MySQL核心服务层：主要提供，包括查询解析、分析、优化、缓存及所有内置函数（比如日期、时间、数学和加密），所有的跨存储引擎的功能都在这一层.</li>
<li>第三层：存储引擎层，负责数据的存储和提取。服务器通过Api与存储引擎进行通信，这些接口屏蔽了不同存储引擎之间的差异，使得这些差异对上层的查询过程透明。</li>
</ul>
<h1 id="MySQL存储引擎"><a href="#MySQL存储引擎" class="headerlink" title="MySQL存储引擎"></a>MySQL存储引擎</h1><p>从上一节可以知道MySQL实际存储的数据是放在存储引擎这一层的，提到MySQL的存储引擎就不得不提到这两种存储引擎：<strong>MyISAM</strong>、<strong>InnoDB</strong>，MyISAM是不支持事务、也不支持外键，优势是访问速度快 ，是MySQL5.5.5之前版本默认的存储引擎，而InnoDB是现在最流行的MySQL存储引擎，因为它支持事务（ACID），支持行锁定和外键。</p>
<h2 id="聚簇索引与非聚簇索引"><a href="#聚簇索引与非聚簇索引" class="headerlink" title="聚簇索引与非聚簇索引"></a>聚簇索引与非聚簇索引</h2><p>聚簇索引的叶子节点就是数据节点，而非聚簇索引的叶子节点仍然是索引节点，只不过有指向对应数据块的指针。 </p>
<h2 id="MyISAM存储引擎"><a href="#MyISAM存储引擎" class="headerlink" title="MyISAM存储引擎"></a>MyISAM存储引擎</h2><p>每个MyISAM在磁盘上存储成3个文件，其中文件名和表名都相同，但是扩展名分别为：</p>
<ul>
<li>.frm(存储表定义)</li>
<li>MYD(MYData，存储数据)</li>
<li>MYI(MYIndex，存储索引</li>
</ul>
<p>MyISAM引擎使用B+Tree作为索引结构，叶节点的data域存放的是数据记录的地址。下图是MyISAM索引的原理图：</p>
<p><img src="http://www.muyesanren.com/wp-content/uploads/2017/05/img_592bcbde4d87d.png" alt="MyISAM主索引结构"> </p>
<p>在MyISAM中，主索引和辅助索引在结构上没有任何区别。</p>
<p><img src="http://www.muyesanren.com/wp-content/uploads/2017/05/img_592bcc3544dcd.png" alt="辅助索引结构"> </p>
<h2 id="InnoDB存储引擎"><a href="#InnoDB存储引擎" class="headerlink" title="InnoDB存储引擎"></a>InnoDB存储引擎</h2><p>而InnoDB在磁盘上存储成2个文件，其中文件名和表名都相同，但是扩展名分别为：</p>
<ul>
<li>.frm(存储表定义)</li>
<li>.ibd(InnoDB data，存储索引与数据)</li>
</ul>
<h3 id="聚集索引与非聚集索引"><a href="#聚集索引与非聚集索引" class="headerlink" title="聚集索引与非聚集索引"></a>聚集索引与非聚集索引</h3><blockquote>
<p>聚集索引的叶子节点就是数据节点，而非聚集索引的叶子节点仍然是索引节点，只不过有指向对应数据块的指针。 </p>
</blockquote>
<p>InnoDB与MyISAM的第一个重大区别就是InnoDB的数据文件本身就InnoDB是采用聚簇索引，也就是InnoDB的数据文件本身就是索引文件。而MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。</p>
<p><img src="http://www.muyesanren.com/wp-content/uploads/2017/05/img_592bccb8a6b9e.png" alt="InnoDB主索引示意图"></p>
<p>上图是InnoDB主索引（同时也是数据文件）的示意图，可以看到叶节点包含了完整的数据记录。因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。</p>
<p>第二个区别是与MyISAM索引的不同是InnoDB的辅助索引data域存储相应记录主键的值而不是地址。换句话说，InnoDB的所有辅助索引都引用主键作为data值。</p>
<p><img src="http://www.muyesanren.com/wp-content/uploads/2017/05/img_592bccf960c2a.png" alt="InnoDB辅助索引示意图"></p>
<p>聚集索引这种实现方式使得按主键的搜索十分高效，但是辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。</p>
<p>为什么InnoDB没有像MyISAM一样直接指向数据行的物理地址呢？如果采用这种策略的话，每次对B+Tree节点进行分裂的时候，也就是物理地址发生改变的时候，二级索引需要全部重写。而InnoDB对二级索引之存储二级索引的列值和对应的主键值，它使得二级索引依赖主键索引的物理顺序，但是辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。两者互有利弊, 权衡而视。</p>
<h1 id="InnoDB实际存储结构"><a href="#InnoDB实际存储结构" class="headerlink" title="InnoDB实际存储结构"></a>InnoDB实际存储结构</h1><p>Page是整个InnoDB存储的最基本构件，也是InnoDB磁盘管理的最小单位，与数据库相关的所有内容都存储在这种Page结构里。</p>
<ul>
<li><p>磁盘空间被划分为许多大小相同页(Page).(MySQL默认Page大小为16K)</p>
</li>
<li><p>一个表的这些数据块以链表的方式串联在一起。</p>
</li>
<li><p>数据是以行（Row）为单位一行一行的存放在磁盘上的块中,如图所示.</p>
</li>
<li><p>在访问数据时，一次从磁盘中读出或者写入至少一个完整的Page。</p>
</li>
</ul>
<p>Page页面存储格式如下图所示： </p>
<p><img src="http://images2015.cnblogs.com/blog/524341/201604/524341-20160416104952770-1354249661.jpg" alt="MySQL数据叶结构"> </p>
<p>  下面是InnoDB的表空间结构图： </p>
<p><img src="http://images2015.cnblogs.com/blog/524341/201604/524341-20160416104932379-1446683950.jpg" alt="表空间"> </p>
<p>PS：扇区是块设备的最小寻址单元，为512个字节，块是文件系统进行IO的最小单元，就是说，块是逻辑上的最小单元 ，一般为4K。</p>
<h1 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h1><p>从上面的内容可以看出索引对数据查找的重要性，所以提供两点建议：</p>
<ol>
<li>尽量采用索引进行查找，防止索引失效。</li>
<li>尽量使用自增自带作为主键，因为非单调的主键会造成在插入新记录时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效。</li>
</ol>

                
<p class="pink-link-context">
    <a href="/2018/08/06/processor-and-thread/" rel="next" title="进程与线程">
    上一篇：进程与线程
  </a>
</p>



<p class="pink-link-context">
    <a href="/2018/06/17/linux-and-location-problem/" rel="next" title="在Linux服务器上定位问题">
    下一篇：在Linux服务器上定位问题
  </a>
</p>


            </div>
			
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="菜单"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="https://weibo.com/2776809852" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/cangqiong" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <div class="site-visitors-container white-text">
        <span>
            <i class="fa fa-user"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
        </span>
        <span>&nbsp;|&nbsp;</span>
        <span>
            <i class="fa fa-eye"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
        </span>
    </div>


            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://www.importnew.com/" target="_blank">ImportNew：Java技术分享网站</a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">Hexo主题raytaylorlin</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2018 cangqiong.github.io, All rights reserved. 
<i class="fa fa fa-heart"></i>
            <p class="right" style="margin-top: 0;">
            <span id="busuanzi_container_site_uv" style="display:none">
            您好，您是本站点的第 <span id="busuanzi_value_site_uv" style="color: yellow;"></span> 位访客，祝您生活工作愉快
            </span></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('.menu-search').append('<span class="new badge green-light"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>








<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</body>
</html>
